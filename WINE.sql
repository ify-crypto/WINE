
 


CREATE TABLE WINE(
WINE_ID VARCHAR(10) PRIMARY KEY NOT NULL,
CATEGORY VARCHAR (15) NOT NULL,
WINE_YEAR INT NOT NULL,
DEGREE FLOAT NOT NULL
);



CREATE TABLE PRODUCER(
PRODUCER_ID  VARCHAR (8) PRIMARY KEY NOT NULL,
FIRST_NAME VARCHAR (12) NOT NULL,
LAST_NAME VARCHAR (12) NOT NULL,
REGION VARCHAR(15)
);


DROP TABLE PRODUCER


CREATE TABLE HARVEST(
QUANTITY  INT PRIMARY KEY NOT NULL,
WINE_ID VARCHAR (10) FOREIGN KEY REFERENCES WINE(WINE_ID)NOT NULL ,
PRODUCER_ID VARCHAR(8)FOREIGN KEY REFERENCES PRODUCER(PRODUCER_ID) NOT NULL
);




INSERT INTO WINE VALUES
('W1','RED',2019,13.5),  
('W2','WHITE',2020,12.0),
('W3','ROSE',2018,11.5),
('W4','RED',2021,14.0),
('W5','SPARKLING',2017,10.5),
('W6','WHITE',2019,12.5),
('W7','RED',2022,13.0),
('W8','ROSE',2020,11.0),
('W9','RED',2018,12.0),
('W10','SPARKLING',2019,10.0),
('W11','WHITE',2021,11.5),
('W12','RED',2022,15.0);

SELECT*FROM[dbo].[WINE]
SELECT*FROM[dbo].[PRODUCER]


INSERT INTO PRODUCER VALUES
('P1','JOHN','SMITH','SOUSSE'),
('P2','EMMA','JOHNSON','TUNIS'),
('P3','MICHEAL','WILLIAMS','SFAX'),
('P4','EMILY','BROWN','SOUSSE'),
('P5','JAMES','JONES','SOUSSE'),
('P6','SARAH','DAVIS','TUNIS'),
('P7','DAVID','MILLER','SFAX'),
('P8','OLIVIA','WILSON','MONASTIR'),
('P9','DANIEL','MOORE','SOUSSE'),
('P10','SOPHIA','TAYLOR','TUNIS'),
('P11','MATTHEW','ANDERSON','SFAX'),
('P12','AMELIA','THOMAS','SOUSSE');



INSERT INTO HARVEST VALUES
('200','W1','P1'),
('250','W2','P2'),
('300','W3','P3'),
('450','W3','P5'),
('200','W11','P3'),
('400','W4','P2'),
('40','W5','P5'),
('25','W3','P11'),
('405','W6','P6'),
('65','W12','P9'),
('110','W10','P10'),
('105','W11','P10'),
('305','W10','P11');





-- Retrieve a list of all producers.

SELECT*FROM [dbo].[PRODUCER]



--Retrieve a sorted list of producers by name.

SELECT FIRST_NAME,LAST_NAME
FROM[dbo].[PRODUCER]
ORDER BY FIRST_NAME,LAST_NAME






-- Retrieve a list of producers from Sousse.

SELECT PRODUCER_ID,FIRST_NAME,LAST_NAME,REGION
FROM[dbo].[PRODUCER]
WHERE REGION = 'SOUSSE'





--Calculate the total quantity of wine produced with the wine number 12.

SELECT* FROM[dbo].[HARVEST]

SELECT WINE_ID,SUM(QUANTITY) AS TOTAL_QUANTITY
FROM[dbo].[HARVEST]
WHERE WINE_ID = 'W12'
GROUP BY WINE_ID
ORDER BY SUM(QUANTITY)





--Calculate the quantity of wine produced for each category.
SELECT* FROM[dbo].[HARVEST]
SELECT* FROM[dbo].[WINE]

SELECT W.CATEGORY ,SUM(H.QUANTITY) AS TOTAL_WINE_CATEGORY
FROM [dbo].[HARVEST]H
LEFT JOIN [dbo].[WINE]W
ON H.WINE_ID = W.WINE_ID
GROUP BY W.CATEGORY
ORDER BY SUM(H.QUANTITY)




--Find producers in the Sousse region who have harvested at least one wine in quantities greater than 300 liters. 
--Display their names and first names, sorted alphabetically.

SELECT *FROM[dbo].[PRODUCER]
SELECT * FROM[dbo].[HARVEST]

SELECT P.FIRST_NAME,P.LAST_NAME,P.REGION,H.WINE_ID,SUM(H.QUANTITY)AS QUANTITIES_IN_WINE
FROM[dbo].[PRODUCER]P
RIGHT JOIN [dbo].[HARVEST]H
ON P.PRODUCER_ID = H.PRODUCER_ID
WHERE P.REGION = 'SOUSSE'
GROUP BY P.FIRST_NAME,P.LAST_NAME,P.REGION,H.WINE_ID
HAVING SUM(H.QUANTITY)>300
ORDER BY SUM(H.QUANTITY)




--List the wine numbers with a degree greater than 12, produced by producer number 24.
SELECT * FROM [dbo].[WINE]
SELECT* FROM[dbo].[HARVEST]

SELECT W.WINE_ID,W.DEGREE,H.PRODUCER_ID
FROM[dbo].[WINE]W
INNER JOIN [dbo].[HARVEST]H
ON W.WINE_ID = H.WINE_ID
WHERE W.DEGREE >12
AND H.PRODUCER_ID = 'P24'




--Find the producer who has produced the highest quantity of wine.

SELECT * FROM [dbo].[PRODUCER]
SELECT* FROM[dbo].[HARVEST]

SELECT P.PRODUCER_ID,P.FIRST_NAME,MAX(H.QUANTITY) AS NO_OF_WINE
FROM[dbo].[PRODUCER]P
RIGHT JOIN[dbo].[HARVEST]H
ON P.PRODUCER_ID = H.PRODUCER_ID
GROUP BY P.PRODUCER_ID,P.FIRST_NAME
ORDER BY MAX(H.QUANTITY) DESC


--Find the average degree of wine produced.
SELECT *FROM[dbo].[WINE]

SELECT AVG(DEGREE)AS AVG_DEGREE_WINE
FROM[dbo].[WINE]



--Find the oldest wine in the database.

SELECT * FROM [dbo].[WINE]

SELECT COUNT(DISTINCT WINE_ID)AS WINE_ID,CATEGORY,WINE_YEAR
FROM[dbo].[WINE]
GROUP BY CATEGORY,WINE_YEAR
ORDER BY WINE_YEAR ASC



--Retrieve a list of producers along with the total quantity of wine they have produced.

SELECT*FROM[dbo].[PRODUCER]
SELECT* FROM[dbo].[HARVEST]

SELECT P.FIRST_NAME,P.LAST_NAME,SUM(H.QUANTITY)AS TOTAL_QUANTITY
FROM[dbo].[PRODUCER]P
RIGHT JOIN[dbo].[HARVEST]H
ON P.PRODUCER_ID = H.PRODUCER_ID
GROUP BY P.FIRST_NAME,P.LAST_NAME

-- Retrieve a list of wines along with their producer details.

SELECT* FROM[dbo].[WINE]
SELECT* FROM[dbo].[PRODUCER]
SELECT* FROM[dbo].[HARVEST]

SELECT W.CATEGORY,P.PRODUCER_ID,P.FIRST_NAME,P.LAST_NAME
FROM[dbo].[PRODUCER]P
RIGHT JOIN [dbo].[HARVEST]H
ON P.PRODUCER_ID = H.PRODUCER_ID
INNER JOIN[dbo].[WINE]W
ON W.WINE_ID = H.WINE_ID



